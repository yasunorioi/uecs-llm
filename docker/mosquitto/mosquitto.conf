# Mosquitto Configuration for AgriHA Node-RED
# Version: 1.0.0
# 作成日: 2026-02-04

# ========================================
# General Settings
# ========================================

# 永続化設定
persistence true
persistence_location /mosquitto/data/

# ログ設定
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ========================================
# Listener Settings
# ========================================

# MQTT標準ポート (1883) — 0.0.0.0 で全I/Fにbind (VPN経由のnuc接続用)
listener 1883 0.0.0.0
protocol mqtt

# WebSocketポート (9001) - オプション
listener 9001 0.0.0.0
protocol websockets

# ========================================
# Security Settings
# ========================================

# 匿名接続を許可（開発環境用）
# 本番環境では false に設定し、認証を有効化すること
allow_anonymous true

# パスワードファイル（本番環境用）
# password_file /mosquitto/config/passwd
# acl_file /mosquitto/config/acl

# ========================================
# Connection Settings
# ========================================

# 最大接続数
max_connections -1

# キープアライブ（秒）
max_keepalive 120

# メッセージサイズ上限（バイト）
max_packet_size 1048576

# ========================================
# Retained Messages
# ========================================

# Retained メッセージの永続化
retain_available true

# ========================================
# Queue Settings
# ========================================

# オフラインクライアントへのキュー
max_queued_messages 1000
max_queued_bytes 0

# QoS 1/2 メッセージの再送間隔（秒）
# retry_interval は Mosquitto 2.x で廃止されました

# ========================================
# Topic Settings for AgriHA
# ========================================
# 推奨トピック構造:
#
# agriha/sensor/{house_id}/{sensor_type}
#   例: agriha/sensor/h1/temperature
#       agriha/sensor/h1/humidity
#       agriha/sensor/h1/co2
#
# agriha/actuator/{house_id}/{device_type}/state
#   例: agriha/actuator/h1/valve1/state
#
# agriha/actuator/{house_id}/{device_type}/command
#   例: agriha/actuator/h1/valve1/command
#
# agriha/status/{node_id}
#   例: agriha/status/pico-h1-sen
#
# ========================================
